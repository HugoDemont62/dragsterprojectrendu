{% extends "base.html" %}
{% block content %}
    <a href="{% url "base:logout" %}">logout</a>

    <a>Classements</a>
    <a>RÃ¨gles</a>
    <div class="groupVoitureQuiRoule">
        {% for car in cars %}
            <img class="voiture-qui-roule" id="{{ car.name }}" src="../static/assets/{{ car.name }}.png">
        {% endfor %}
    </div>
    <p>Quelle sera la vitesse maximum atteinte par les coureurs ?</p>

    <p>Qui va gagner la course ?</p>
    <div class="groupVoiture">
        {% for car in cars %}
            <img class="voiture" src="../static/assets/{{ car.name }}.png">
        {% endfor %}
    </div>

    <p>Va-t-il y avoir un crash pendant la course ?</p>
    <p>Oui !</p>
    <p>Non !</p>

    <p>Quelle voiture va se crasher ?</p>
    <div class="groupVoiture">
        {% for car in cars %}
            <img class="voiture" src="../static/assets/{{ car.name }}.png">
        {% endfor %}
    </div>

    <script>
    let raceOver = false;

    setInterval(function() {
      if (raceOver) return;

      let carElement;
      {% for car in cars %}
        carElement = document.getElementById('{{ car.name }}');
        if (carElement) {
          let bottom = parseInt(carElement.style.bottom, 10);
          if (isNaN(bottom)) {
            bottom = 0;
          }
          let speed = Math.floor(Math.random() * {{ car.max_speed }}) + 1;
          bottom += speed;
          carElement.style.bottom = bottom + 'px';

          if (bottom + carElement.offsetHeight >= window.innerHeight) {
            console.log('{{ car.name }} has reached the top!');
            raceOver = true;
          }
        }
      {% endfor %}
    }, 1000);
    </script>
{% endblock content %}